ì°¸ê³  - https://nomadcoders.co/react-native-for-beginners/lectures/3127

* 3.0 ëŒ€ì‹ ì— 2.5 ë¥¼ API URL ì— ì‚¬ìš©í•˜ì„¸ìš”.



/*
ëŒ“ê¸€
1.
(23-01-22) APIë¥¼ ê²°ì œí•˜ì§€ ì•Šê³  ì“°ì‹œê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì„ ìœ„í•´ ì”ë‹ˆë‹¤.
OpenWeather ì‚¬ì´íŠ¸ì—ì„œ ë¬´ë£Œ ë²„ì „ì„ ì“°ì‹œëŠ” ê²½ìš° ë‚ ì”¨ ê´€ë ¨í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” APIëŠ” 2ê°œì…ë‹ˆë‹¤.
1. Current Weather
2. 3-hour Forecast 5 days
(* êµ¬ë…ë³„ ì‚¬ìš© ê°€ëŠ¥ API í™•ì¸ : https://openweathermap.org/price )

ì´ ì¤‘ ì—¬ëŸ¬ ë‚ ì§œì˜ ë‚ ì”¨ë¥¼ í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ 3-hour Forecast 5 days ( https://openweathermap.org/forecast5 ) ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤. ê·¸ëƒ¥ ì‚¬ì´íŠ¸ì˜ API callì„ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°í•˜ë©´ ì•ì— "https://"ê°€ ì•ˆ ì í˜€ ìˆìœ¼ë‹ˆ ì™œ ì•ˆë˜ëŠ”ì§€ ì°¾ëŠë¼ ì €ì²˜ëŸ¼ ê³ ìƒí•˜ì§€ ë§ˆì„¸ìš”.
fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${API_KEY}&units=metric`);

ê·¼ë° ì´ ë°ì´í„°ëŠ” 1ì¼ë§ˆë‹¤ê°€ ì•„ë‹Œ 3ì‹œê°„ë§ˆë‹¤ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ì›í•˜ëŠ” ì‹œê°„ëŒ€ì˜ ë‚ ì”¨ë¥¼ ì–»ì–´ì•¼ í•©ë‹ˆë‹¤. ë‚ ì”¨ ë°ì´í„°ëŠ” ì˜¤ë¸Œì íŠ¸(json) ë‚´ë¶€ì— {list : [ë°°ì—´]} ë¡œ ì¡´ì¬í•˜ë©°, ë°°ì—´ì˜ ìš”ì†Œ ì•ˆì—ëŠ” dt_txtë¡œ í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì´ ì íŒ ë¬¸ìì—´ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ìì„¸í•œ êµ¬ì„± ìš”ì†ŒëŠ” ìœ„ì˜ 3-hour Forecast 5 days ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì–´ì¨Œë“  ê·¸ê²ƒì„ ì´ìš©í•´ì„œ ì›í•˜ëŠ” ì‹œê°„ëŒ€ì˜ ë‚ ì”¨ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ì €ëŠ” 0ì‹œì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
setDays(
json.list.filter((weather) => {
if (weather.dt_txt.includes("00:00:00")) {
return weather;
}
})
);

ì´í›„ ë‚ ì”¨ì˜ ì˜¨ë„ì™€ main ë‚ ì”¨, descriptionì„ ì¶œë ¥í•˜ëŠ” ì½”ë“œë¥¼ map ì•ˆì— ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥í–ˆìŠµë‹ˆë‹¤. ìŠ¤íƒ€ì¼ì€ ì‚¬ëŒë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
View key={index} style={styles.day}>
Text style={styles.temp}>
{parseFloat(day.main.temp).toFixed(1)}
/Text>
Text style={styles.description}>{day.weather[0].main}
Text style={styles.tinyText}>{day.weather[0].description}
/Text>
/View>
[* ë§¨ ì•ì— < ë¶™ì´ê¸°]

ì´ë ‡ê²Œ í•˜ë©´ ì €ëŠ” ì˜ ë‚˜ì˜¤ë„¤ìš” ğŸ‘


2.
(2022. 11. 03 ê¸°ì¤€)
One Call API 3.0 ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. fetch(`URL`)
-> https://api.openweathermap.org/data/3.0/onecall?lat={lat}&lon={lon}&exclude=alerts&appid={API key}

2. One Call APIì— Subscription í•˜ê¸°
-> https://home.openweathermap.org/subscriptions/billing_info/onecall_30/base?key=base&service=onecall_30ì— ì ‘ì†í•´ì„œ ì…ë ¥í•˜ë¼ëŠ” ì •ë³´ë“¤ê³¼ ìì‹ ì˜ ì¹´ë“œ ì •ë³´ ì…ë ¥(API ìš”ì²­ 100íšŒë§ˆë‹¤ 0.12íŒŒìš´ë“œ(í•œí™” 200ì› ì•ˆ ë¨) ê²°ì œ. 100íšŒë‚˜ ìš”ì²­í•  ê²ƒë„ ì—†ì–´ì„œ ì‚¬ì‹¤ìƒ ë¬´ë£Œ)

3. ì´í›„ ë˜ë‹¤ì‹œ ì—ëŸ¬ëœ¨ë©´, ì—ëŸ¬ ë©”ì„¸ì§€ ì œì¼ ì•„ë˜ì— ìˆëŠ” URLë¡œ ë“¤ì–´ê°„ ë’¤ code:401 ì„ íƒ í›„ Email confirmation í•˜ë©´ ë©ë‹ˆë‹¤.


3.
invalid api ë‚˜ì˜¤ì‹œëŠ” ë¶„ë“¤ í•˜ë‹¨ api ë¡œ ë°”ê¿”ì„œ ì‚¬ìš©í•´ë³´ì„¸ìš” - https://openweathermap.org/current
*/



askë¥¼ getWeatherë¡œ ì´ë¦„ì„ ë°”ê¾¸ì–´ ì£¼ì—ˆê³  locationì´ë¼ëŠ” stateë„ ì§€ì› ë‹¤. ê·¸ë¦¬ê³  ë‚ ì”¨ë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•´ daysë¼ëŠ” state ì¶”ê°€
ex) App.js
...
  const [city, setCity] = useState("Loading...");
  const [days, setDays] = useState([]);
  const [ok, setOk] = useState(true);
  const getWeather = async () => {
    const { granted } = await Location.requestForegroundPermissionsAsync();
    if (!granted) {
      setOk(false);
    }
    const {
      coords: { latitude, longitude },
      // } = await Location.getLastKnownPositionAsync({ accuracy: 5 });
    } = await Location.getCurrentPositionAsync({ accuracy: 5 });

    Location.setGoogleApiKey("AIzaSyBrCqiddDH1pUKIXy_KRD2gqEpqjxJ9SBY");
    const place = await Location.reverseGeocodeAsync(
      {
        latitude,
        longitude,
      },
      { useGoogleMaps: false },
    );
    setCity(place[0].city);
  };
  useEffect(() => {
    getWeather();
  }, []);
...


ì •ë³´ë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•´ open weather APIë¼ëŠ” ì‚¬ì´íŠ¸ë¥¼ ì´ìš©í•  ê²ƒì´ë‹¤.
open weather API - https://openweathermap.org/
ì´ ì‚¬ì´íŠ¸ì— ê°€ì…í•˜ê³  API keyë¥¼ ë°›ì•„ì•¼í•œë‹¤.
ë‚´ API key - https://home.openweathermap.org/api_keys
ì´ì œ API keyë¥¼ ë³µì‚¬í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì¤€ë‹¤.
ex) App.js
...
const API_KEY = "c3d64abd985a5e5d422ceeefa8ed7137";
...

ì•Œë‹¤ì‹œí”¼ ì´ê±´ ì•ˆì „í•œ ë°©ë²•ì´ ì•„ë‹ˆë‹¤ ìš°ë¦¬ applicationì— API keyë¥¼ ë„£ìœ¼ë©´ ì•ˆëœë‹¤. ì‹¤ì œë¡œ ì´ê²Œ ë‚´ applicationì´ë¼ë©´ ì´ API keyë¥¼ ì„œë²„ì— ë‘˜ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ open weatherì˜ API keyëŠ” ë¬´ë£Œì´ê¸°ë•Œë¬¸ì— applicationì—ì„œ ì‚¬ìš©í•  ê²ƒì´ë‹¤.

ë‹¤ìŒì€ one call APIë¡œ ì´ë™ - https://openweathermap.org/api/one-call-3
* 3.0ì´ ì•„ë‹Œ 2.5ë¥¼ ì‚¬ìš©í•˜ë¼ê³  í–ˆìŒ
ìš°ë¦¬ëŠ” Daily forecast for 8 days ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.
ex) App.js
...
  const getWeather = async () => {
    const { granted } = await Location.requestForegroundPermissionsAsync();
    if (!granted) {
      setOk(false);
    }
    const {
      coords: { latitude, longitude },
      // } = await Location.getLastKnownPositionAsync({ accuracy: 5 });
    } = await Location.getCurrentPositionAsync({ accuracy: 5 });

    Location.setGoogleApiKey("AIzaSyBrCqiddDH1pUKIXy_KRD2gqEpqjxJ9SBY");
    const place = await Location.reverseGeocodeAsync(
      {
        latitude,
        longitude,
      },
      { useGoogleMaps: false },
    );
    setCity(place[0].city);
    const response = await fetch(
      `https://api.openweathermap.org/data/3.0/onecall?lat=${latitude}&lon=${longitude}&exclude=alerts&appid=${API_KEY}`,
    );
    const json = await response.json();
    console.log(json);
...

ë˜ ì—ëŸ¬ ì¶œë ¥ë¨..
cod: 401
message: "Invalid API key. Please see https://openweathermap.org/faq#error401 for more info."

ì•„ë˜ apië¡œ ë³€ê²½í•´ì„œ ì‚¬ìš©
https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API key}
ëœë‹¤
ex) App.js
...
    const response = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${API_KEY}`,
    );
    const json = await response.json();
    console.log(json);
...

console ì¶œë ¥
base: "stations"
clouds: {all: 0}
cod: 200
coord: {lon: 127.1151, lat: 37.3502}
dt: 1675671809
id: 6573747
main: {temp: 280.84, feels_like: 280.12, temp_min: 277.55, temp_max: 281.84, pressure: 1020, â€¦}
name: "Dongjinwon"
sys: {type: 1, id: 5509, country: 'KR', sunrise: 1675636265, sunset: 1675674004}
timezone: 32400
visibility: 8000
weather: [{â€¦}]
wind: {speed: 1.54, deg: 30}


ì´ì œ ìš°ë¦¬ëŠ” daily arrayì— ì ‘ê·¼í•˜ë©´ ëœë‹¤.(setDaysì— json.daily ì €ì¥)
* ê°•ì˜ì—ì„œëŠ” json.dailyë¡œ í•´ì£¼ì—ˆì§€ë§Œ ë‚˜ëŠ” json.weatherë¡œ í•´ì¤Œ, daily ì†ì„±ì´ ì—†ìŒ
í‘œì‹œí•´ì£¼ê¸° ì „ì— ìš°ë¦¬ëŠ” ë¡œë”©í™”ë©´ì„ ì¶œë ¥í•´ì¤„ ê²ƒì´ë‹¤. react native ë¬¸ì„œì—ì„œ Activity indicator ë¼ëŠ” component ì‚¬ìš©(ë¡œë”© ì• ë‹ˆë©”ì´ì…˜)
ex) App.js
import React, { useEffect, useState } from "react";
import * as Location from "expo-location";
import {
  ScrollView,
  StyleSheet,
  Dimensions,
  Text,
  View,
  ActivityIndicator,
} from "react-native";
import { StatusBar } from "expo-status-bar";

const { width: SCREEN_WIDTH } = Dimensions.get("window");

const API_KEY = "c3d64abd985a5e5d422ceeefa8ed7137";

export default function App() {
  const [city, setCity] = useState("Loading...");
  const [days, setDays] = useState([]);
  const [ok, setOk] = useState(true);
  const getWeather = async () => {
    const { granted } = await Location.requestForegroundPermissionsAsync();
    if (!granted) {
      setOk(false);
    }
    const {
      coords: { latitude, longitude },
      // } = await Location.getLastKnownPositionAsync({ accuracy: 5 });
    } = await Location.getCurrentPositionAsync({ accuracy: 5 });

    Location.setGoogleApiKey("AIzaSyBrCqiddDH1pUKIXy_KRD2gqEpqjxJ9SBY");
    const place = await Location.reverseGeocodeAsync(
      {
        latitude,
        longitude,
      },
      { useGoogleMaps: false },
    );
    setCity(place[0].city);
    const response = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${API_KEY}&units=metric`, // &units=metricì€ ì˜¨ë„(temp?)ë‹¨ìœ„ ë³€ê²½
    );
    const json = await response.json();
    console.log(json);
    setDays(json);
  };
  useEffect(() => {
    getWeather();
  }, []);

  return (
    <View style={styles.container}>
      <View style={styles.city}>
        <Text style={styles.cityName}>{city}</Text>
      </View>
      <ScrollView
        pagingEnabled
        horizontal
        showsHorizontalScrollIndicator={false}
        contentContainerStyle={styles.weather}
      >
        {days.length === 0 ? (
          <View style={styles.day}>
            <ActivityIndicator
              color="white"
              style={{ marginTop: 10 }}
              size="large"
            />
          </View>
        ) : (
          days.weather.map((day, index) => (
            <View key={index} style={styles.day}>
              <Text style={styles.temp}>
                {parseFloat(days.main.temp).toFixed(1)}
              </Text>
              <Text style={styles.description}>{day.main}</Text>
              <Text style={styles.tinyText}>{day.description}</Text>
            </View>
          ))
        )}
      </ScrollView>
      <StatusBar style="auto" />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#1e83a4",
  },
  city: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
  },
  cityName: {
    fontSize: 68,
    fontWeight: "500",
  },
  weather: {
    // flex: 3,
    // backgroundColor: "#369bbc",
  },
  day: {
    width: SCREEN_WIDTH,
    alignItems: "center",
  },
  temp: {
    marginTop: 50,
    fontSize: 100,
  },
  description: {
    marginTop: -30,
    fontSize: 62,
  },
  tinyText: {
    fontSize: 20,
  },
});


ë‹¤ìŒ ê°•ì˜ì—ì„œëŠ” ì•„ì´ì½˜ì„ ë„£ì„ ê²ƒì´ë‹¤.